version: '3.9'

services:
  python-service:
    build: ./python-service
    container_name: python-service
    ports:
      - "8000:8000"
    volumes:
      - uploads_data:/app/uploads
    depends_on:
      - redis
      - qdrant
    networks:
      - app-network
    environment:
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GOOGLE_GENAI_UPLOAD_TIMEOUT: ${GOOGLE_GENAI_UPLOAD_TIMEOUT:-1000}

  backend-service:
    build: ./backend-service
    container_name: backend-service
    ports:
      - "8080:8080"
    environment:
      API_BASE_URL: ${API_BASE_URL:-http://python-service:8000}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      API_MODEL_PROVIDER: ${API_MODEL_PROVIDER:-gemini}
      API_MODEL_NAME: ${API_MODEL_NAME:-gemini-2.0-flash}
    depends_on:
      - python-service
    networks:
      - app-network

  frontend-service:
    build: ./frontend-service
    container_name: frontend-service
    ports:
      - "3000:3000"
    depends_on:
      - backend-service
    networks:
      - app-network
    environment:
      # Allows React dev code (if any runtime fetch) to know backend base URL
      REACT_APP_BACKEND_URL: ${API_BASE_URL:-http://localhost:8080}

  redis:
    image: redis:alpine
    container_name: redis
    ports:
      - "6379:6379"
    networks:
      - app-network

  qdrant:
    image: qdrant/qdrant
    container_name: qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    networks:
      - app-network

volumes:
  uploads_data:

networks:
  app-network:
    name: app-network
    driver: bridge